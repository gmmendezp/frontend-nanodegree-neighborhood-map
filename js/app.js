var CONFIG={MAP_CENTER:{lat:46.9487991,lng:7.4473715},MAP_ZOOM:16,FOURSQUARE_CLIENT_ID:"3Y0A1BQI1KGNCALQWUXQH4AGHXLUDOQKIMD0VANL0D5HPPZC",FOURSQUARE_CLIENT_SECRET:"XNXWRZBHGVGKMDNLPVXZC0I3PSNEO041WAGAMVQ0OBG3J2EV",FOURSQUARE_API_URL:"https://api.foursquare.com/v2/venues/",FOURSQUARE_EXPLORE:"explore",MAX_PLACES:20,ERROR_TEMPLATE:'<div class="error">{{error}}</div>',INFO_TEMPLATE:""};$(function(){$.get({url:"/info.html",success:function(a){CONFIG.INFO_TEMPLATE=a},error:function(){CONFIG.INFO_TEMPLATE=CONFIG.ERROR_TEMPLATE.replace("{{error}}","There was a problem retrieving a file, please refresh the page.")}})});var map,getPlaces=function(a){$.get({url:CONFIG.FOURSQUARE_API_URL+CONFIG.FOURSQUARE_EXPLORE,data:{ll:CONFIG.MAP_CENTER.lat+","+CONFIG.MAP_CENTER.lng,limit:CONFIG.MAX_PLACES,client_id:CONFIG.FOURSQUARE_CLIENT_ID,client_secret:CONFIG.FOURSQUARE_CLIENT_SECRET,v:20160930,locale:"en"},success:function(b){a(null,b.response.groups[0].items.map(function(a){return a.venue}))},error:function(b){a("There was a problem loading FourSquare places, reload the page to try again."),console.error(b,[])}})},getVenueInfo=function(a,b){$.get({url:CONFIG.FOURSQUARE_API_URL+a.id,data:{client_id:CONFIG.FOURSQUARE_CLIENT_ID,client_secret:CONFIG.FOURSQUARE_CLIENT_SECRET,v:20160930,locale:"en"},success:function(c){b(null,a,c.response.venue)},error:function(c){b("There was a problem loading this place info from FourSquare, please try again later.",a),console.error(c)}})},applyINFO_TEMPLATE=function(a){var b=CONFIG.INFO_TEMPLATE,c=a.bestPhoto;b=b.split("{{photo}}").join(c.prefix+"cap200"+c.suffix),b=b.split("{{name}}").join(a.name),b=b.split("{{fsUrl}}").join(a.shortUrl);var d=a.categories.map(function(a){return a.name});return b=b.split("{{categories}}").join(d.length?d.join(", "):"No categories"),b=b.split("{{tags}}").join(a.tags.length?a.tags.join(", "):"No tags"),b=b.split("{{rating}}").join(a.rating||""),b=b.split("{{ratingColor}}").join(a.ratingColor||"black"),b=b.split("{{url}}").join(a.url||""),b=b.split("{{phone}}").join(a.contact.formattedPhone||""),b=b.split("{{address}}").join(a.location.formattedAddress.length?a.location.formattedAddress.join(", "):"")},openInfoWindow=function(a,b,c){var d=b.infoWindow;a?d.setContent(CONFIG.ERROR_TEMPLATE.replace("{{error}}",a)):d.setContent(applyINFO_TEMPLATE(c)),d.open(map,b.marker)},initModel=function(a,b){var c=function(){var c=this,d=function(){var a=c.selectedPlace();a!==this?(a&&(a.marker.setAnimation(null),a.infoWindow.close(map,this.marker)),c.selectedPlace(this),this.marker.setAnimation(google.maps.Animation.BOUNCE),getVenueInfo(this,openInfoWindow)):(c.selectedPlace(null),this.marker.setAnimation(null),this.infoWindow.close(map,this.marker))},e=function(a){map&&a.length>0&&a.forEach(function(a){a.marker=new google.maps.Marker({map:map,position:{lat:a.location.lat,lng:a.location.lng},title:a.name}),a.marker.addListener("click",d.bind(a)),a.infoWindow=new google.maps.InfoWindow})};e(b),c.showNav=ko.observable(!1),c.toggleNav=function(){c.showNav(!c.showNav())},c.error=a,c.selectedPlace=ko.observable(),c.searchTerm=ko.observable(""),c.places=ko.computed(function(){var a=b.filter(function(a){return a.name.toUpperCase().indexOf(c.searchTerm().toUpperCase())>-1});return b.forEach(function(a){a.infoWindow.close(map,a.marker);var b=a.name.toUpperCase().indexOf(c.searchTerm().toUpperCase())>-1;b?a.marker.setMap(map):a.marker.setMap(null)}),a},this),c.selectPlace=function(a){d.call(a)}};ko.applyBindings(new c)},initMap=function(){map=new google.maps.Map(document.getElementById("map"),{center:CONFIG.MAP_CENTER,zoom:CONFIG.MAP_ZOOM,clickableIcons:!1,mapTypeControlOptions:{position:google.maps.ControlPosition.TOP_RIGHT}}),getPlaces(initModel)};